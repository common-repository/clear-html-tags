jQuery(document).ready(function($){var getContent=function(){var mce=tinyMCE?tinyMCE.activeEditor:false;if(mce&&!mce.hidden){return mce.getContent({format:"raw"})}else{return jQuery("#"+wpActiveEditor).val()}return false};var setContent=function(content,cb){var mce=tinyMCE?tinyMCE.activeEditor:false;if(mce&&!mce.hidden){mce.setContent(content,{format:"raw"})}else{jQuery("#"+wpActiveEditor).val(content)}cb&&cb()};$("#wb-cls-tag-btn").on("click",function(){wbui.open({className:"wbui-cht",title:"本次优化参数设置",content:wbcht_cnf.data,btn:["执行优化"],success:function(){$tabNavItem=$("#J_wbTabCHT .tab-nav-item");$tabContItem=$("#J_wbTabCHT .tab-cont");$tabNavItem.on("click",function(){var index=$(this).index();$tabNavItem.removeClass("current");$tabContItem.removeClass("current");$(this).addClass("current");$tabContItem.eq(index).addClass("current")})},yes:function(){var content=getContent();var tags=[];$(".wb-cls-tag:checked").each(function(i,n){tags.push($(n).val())});if(tags.length>0){tags=tags.join("|");if(tags&&content){var patten=new RegExp("<("+tags+")\\s[^>]*>","g");var patten1=new RegExp("<("+tags+")>","g");var patten2=new RegExp("</("+tags+")>","g");content=content.replace(patten,"").replace(patten1,"").replace(patten2,"")}}var attrs=[];$(".wb-cls-attr:checked").each(function(i,n){attrs.push($(n).val())});if(attrs.length>0){var patten="",attr="";for(var i=0;i<attrs.length;i++){attr=attrs[i].replace("*","[a-zA-Z0-9_-]+");patten=new RegExp("<([^\\s]+.*?)\\s+"+attr+'="[^"]*"([^>]*)>',"gi");content=content.replace(patten,function(match){var sub_patten=new RegExp("\\s+"+attr+'="[^"]*"',"gi");return match.replace(sub_patten,"")})}}$(".wb-cls-format:checked").each(function(i,n){var v=$(n).val();if(v=="h2p"){patten=new RegExp("(</h[1-9]>)([^\n])","gi");content=content.replace(patten,function(match,p1,p2){return p1+"\n"+p2});patten=new RegExp("([^\n])(<h[1-9])","gi");content=content.replace(patten,function(match,p1,p2){return p1+"\n"+p2})}else if(v=="img2img"||v=="img2p"){patten=new RegExp("(<img[^>]+>)([^\n])","gi");content=content.replace(patten,function(match,p1,p2){return p1+"\n"+p2});patten=new RegExp("([^\n])(<img)","gi");content=content.replace(patten,function(match,p1,p2){return p1+"\n"+p2})}else if(v=="text-indent"){patten=new RegExp("(<p[^>]*>)[\n\\s]+","gi");content=content.replace(patten,function(match,p1){return p1});patten=new RegExp("(\n\\s+)([^\\s])","gi");content=content.replace(patten,function(match,p1,p2){return"\n"+p2});patten=new RegExp("(<p[^>]*>)(&nbsp;)+","gi");content=content.replace(patten,function(match,p1){return p1})}else if(v=="p2p"){patten=new RegExp("(</p[^>]*>)([^\n])","gi");content=content.replace(patten,function(match,p1,p2){return p1+"\n"+p2});patten=new RegExp("([^\n])(<p)","gi");content=content.replace(patten,function(match,p1,p2){return p1+"\n"+p2})}});$(".cls-re-c:checked").each(function(i,n){var box=$(this).parent().parent();var s=box.find(".cls-re-s").val();var r=box.find(".cls-re-r").val();if(!s){return}s=s.replace("*",".*?");try{var patten=new RegExp(s,"gi");content=content.replace(patten,r)}catch(e){console.log(e)}});setContent(content,function(){wbui.toast("清除成功")})}});var magicpostTips=localStorage.getItem("wbMagicpostTips");!magicpostTips&&wbui.open({title:"温馨提示",content:'<div>由于产品线调整，HTML代码优化工具正式整合到<a href="https://www.wbolt.com/plugins/magicpost?ref=cht-alert" class="link" target="magicpost">Magicpost插件</a>，该插件将包括定时发布、文章搬家、HTML清理、下载管理和社交分享等模块。</div>',btn:["查看详情"],maskClose:false,yes:function(){localStorage.setItem("wbMagicpostTips",true);window.open("https://www.wbolt.com/plugins/magicpost?ref=cht-alert")},end:function(){localStorage.setItem("wbMagicpostTips",true)}})})});