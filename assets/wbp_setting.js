jQuery(document).ready(function($){$("#optionsframework-wrap").find("input,textarea").on("change",function(){$(window).on("beforeunload",function(){return confirm("您修改的设置尚未保存，确定离开此页面吗？")})});$("#optionsframework-submit .wbs-btn-primary").on("click",function(){$(window).unbind("beforeunload")});var _source=$("[data-wba-source]").length&&$("[data-wba-source]").data("wba-source")||window.wbaSource||document.domain;$("a[data-wba-campaign]").each(function(){var me=$(this),_campaign=me.data("wba-campaign"),_media=me.data("wba-media")||"link",_url=me.attr("href");_url+=_url.match("[?]")?"&":"?";_url+="utm_source="+_source;_url+="&utm_media="+_media;_url+="&utm_campaign="+_campaign;me.attr("href",_url)});var magicpostTips=localStorage.getItem("wbMagicpostTips");!magicpostTips&&wbui.open({title:"温馨提示",content:'<div>由于产品线调整，HTML代码优化工具正式整合到<a href="https://www.wbolt.com/plugins/magicpost?ref=cht-alert" class="link" target="magicpost">Magicpost插件</a>，该插件将包括定时发布、文章搬家、HTML清理、下载管理和社交分享等模块。</div>',btn:["查看详情"],maskClose:false,yes:function(){localStorage.setItem("wbMagicpostTips",true);window.open("https://www.wbolt.com/plugins/magicpost?ref=cht-alert")},end:function(){localStorage.setItem("wbMagicpostTips",true)}})});var wbSelectorBar={props:{cnf:Array,opt:Array,format:Boolean},data:function(){return{selectedItems:this.opt}},template:'<div class="selector-bar">\n'+"                                <label>\n"+'                                    <input type="checkbox" :checked="selectedAll" @change="allToggle">\n'+"                                    <span>全部</span>\n"+"                                </label>\n"+'                                <label v-for="(v,k) in cnf">\n'+'                                    <input type="checkbox" v-model="selectedItems" :value="v" :checked="selectedItems.indexOf(v)>-1" @change="updateSelected">\n'+'                                    <span v-html="displayFormat(v)"></span>\n'+"                                </label>\n"+"                            </div>",created:function(){},methods:{allToggle:function(){var vm=this;if(vm.cnf.length!==vm.selectedItems.length){vm.cnf.forEach(function(v){!vm.selectedItems.includes(v)&&vm.selectedItems.push(v)})}else{vm.selectedItems=[]}vm.updateSelected()},updateSelected:function(){var vm=this;vm.$emit("change",vm.selectedItems)},displayFormat:function(v){if(this.format)return"&lt;"+v+"&gt;";return v}},computed:{selectedAll:function(){var vm=this;return this.cnf.length===vm.selectedItems.length}}};var wbTagsModule={props:{tags:Array,all:Array,rule:String,format:Boolean},data:function(){return{cur_input:"",keycode:null}},template:'<label class="wb-tags-ctrl">\n'+'                                <div class="tag-items">\n'+'                                    <div class="tag-item" v-if="taglist.length" v-for="(v,k) in taglist">\n'+'                                        <span v-html="displayFormat(v)"></span>\n'+'                                        <a class="del" @click="delItem(k)" :data-del-val="v"></a>\n'+"                                    </div>\n"+"                                </div>\n"+'                                <input class="wb-tag-input" v-on:keyup="wbTagInput" v-model="cur_input" type="text" placeholder="以空格或回车分隔">\n'+"                            </label>",created:function(){},methods:{wbTagInput:function(e){var vm=this;var keyCode=e.keyCode;var ignoreKey=[8,32,27,37,38,39,40];if(keyCode===32){vm.cur_input=vm.cur_input.trim()}if(keyCode===8){vm.keycode++;if(vm.keycode>2){vm.tags.pop();wbui.toast("已移除");vm.keycode=null}}else{vm.keycode=null}if(!ignoreKey.includes(keyCode)&&!vm.validator.test(vm.cur_input)){vm.cur_input="";return wbui.toast("请确认格式")}if(keyCode===32||keyCode===13){vm.wbTagPush()}},wbTagPush:function(val){var vm=this;if(vm.cur_input=="")return false;if(vm.all.indexOf(vm.cur_input.trim())>-1||vm.taglist.indexOf(vm.cur_input.trim())>-1){wbui.toast("已存在");vm.cur_input="";return false}vm.tags.push(vm.cur_input);vm.$emit("set-tags",vm.tags);vm.cur_input="";return false},delItem:function(key){var vm=this;vm.tags.splice(key,1);wbui.toast("已移除")},displayFormat:function(v){if(this.format)return"&lt;"+v+"&gt;";return v}},computed:{taglist:function(){var arr=this.tags||[];return arr},validator:function(){var vm=this;return new RegExp(vm.rule)}}};var moreWbInfo={props:["utmSource"],data:function(){return{wbMoreData:{},curIndex:0}},filters:{displayDate:function(value){if(!value)return;value=value.split(" ");return value.length?value[0]:value}},template:'<div class="wbolt-products tabs-box">\n'+'    <div class="tab-navs">\n'+'        <div class="tab-nav-item" v-on:mouseover="curIndex = 0" v-bind:class="{current: curIndex === 0}"><span>主题推荐</span></div>\n'+'        <div class="tab-nav-item" v-on:mouseover="curIndex = 1" v-bind:class="{current: curIndex === 1}"><span>插件推荐</span></div>\n'+'        <div class="tab-nav-item" v-on:mouseover="curIndex = 2" v-bind:class="{current: curIndex === 2}"><span>WP教程</span></div>\n'+"    </div>\n"+'    <div class="tab-conts">\n'+'        <div class="tab-cont" v-bind:class="{current: curIndex === 0}">            \n'+'            <ul class="pd-items-b">\n'+'                <li class="pd-item" v-for="item in wbMoreData.themes">\n'+'                    <div class="item-inner">\n'+'                        <a class="post-thumbnail thumbnail-themes" v-bind:href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank">\n'+'                            <img v-bind:src="item.thumb[0]">\n'+"                        </a>\n"+'                        <div class="pd-info">\n'+'                            <a class="pd-name" v-bind:href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank"><em v-if="item.status_tag" class="state-tag" v-bind:class="item.status_tag">{{item.status_tag}}</em><b>{{item.post_title}}</b></a>\n'+'                            <div class="pd-desc">{{item.excerpt}}</div>\n'+'                            <p><a class="btn-sm" :href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank">查看详情</a></p>                        </div>\n'+"\n"+'                        <div class="item-ft">\n'+'                            <span><svg class="wb-icon wbsico-views"><use xlink:href="#wbsico-views"></use></svg> <em>{{item.view_count}}</em></span>\n'+'                            <span><svg class="wb-icon wbsico-time"><use xlink:href="#wbsico-time"></use></svg> <em>{{item.post_date | displayDate}}</em></span>\n'+"                        </div>\n"+"                    </div>\n"+"                </li>\n"+"            </ul>\n"+"        </div>\n"+'        <div class="tab-cont" v-bind:class="{current: curIndex === 1}">\n'+'            <ul class="pd-items-b">\n'+'                <li class="pd-item" v-for="item in wbMoreData.plugins">\n'+'                    <div class="item-inner">\n'+'                        <a class="post-thumbnail thumbnail-plugins" v-bind:href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank">\n'+'                            <img v-bind:src="item.thumb[0]">\n'+"                        </a>\n"+'                        <div class="pd-info">\n'+'                            <a class="pd-name" v-bind:href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank"><em v-if="item.status_tag" class="state-tag" v-bind:class="item.status_tag">{{item.status_tag}}</em><b>{{item.post_title}}</b></a>\n'+'                            <div class="pd-desc">{{item.excerpt}}</div>\n'+'                            <p><a class="btn-sm" :href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank">查看详情</a></p>                        </div>\n'+"\n"+'                        <div class="item-ft">\n'+'                            <span><svg class="wb-icon wbsico-views"><use xlink:href="#wbsico-views"></use></svg> <em>{{item.view_count}}</em></span>\n'+'                            <span><svg class="wb-icon wbsico-time"><use xlink:href="#wbsico-time"></use></svg> <em>{{item.post_date | displayDate}}</em></span>\n'+"                        </div>\n"+"                    </div>\n"+"                </li>\n"+"            </ul>\n"+"        </div>\n"+'        <div class="tab-cont" v-bind:class="{current: curIndex === 2}">\n'+'            <ul class="list-blog">\n'+'                <li class="list-item" v-for="item in wbMoreData.blog">\n'+'                    <div class="item-inner">\n'+'                        <a class="media-pic" v-bind:href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank">\n'+'                            <img v-bind:src="item.thumb[0]">\n'+"                        </a>\n"+'                        <div class="media-body">\n'+'                            <a class="post-title" v-bind:href="withCampaign(item.url)" data-wba-campaign="recommend" target="_blank">{{item.post_title}}</a>\n'+'                            <div class="summary">{{item.excerpt}}</div>\n'+'                            <div class="post-metas">\n'+'                                <span class="meta-item primary">\n'+'                                    <svg class="wb-icon wbsico-time"><use xlink:href="#wbsico-time"></use></svg>\n'+"                                    <em>{{item.post_date | displayDate}}</em>\n"+"                                </span>\n"+'                                <span class="meta-item">\n'+'                                    <svg class="wb-icon wbsico-views"><use xlink:href="#wbsico-views"></use></svg>\n'+"                                    <em>{{item.view_count}}</em>\n"+"                                </span>\n"+'                                <a class="meta-item" href="withCampaign(item.url)">\n'+'                                    <svg class="wb-icon wbsico-comment"><use xlink:href="#wbsico-comment"></use></svg>\n'+"                                    <em>{{item.comment_count}}</em>\n"+"                                </a>\n"+"                            </div>\n"+"                        </div>\n"+"                    </div>\n"+"                </li>\n"+"            </ul>\n"+"        </div>\n"+"    </div>\n"+"</div>",created:function(){this.getData()},methods:{getData:function(){var vm=this;jQuery.get("https://www.wbolt.com/wb-api/v1/rest/newest/",function(ret){if(!ret.code){vm.wbMoreData=ret.data}},"json")},withCampaign:function(_url){if(!_url)return;_url+=_url.match("[?]")?"&":"?";_url+="utm_source="+this.utmSource;_url+="&utm_media=link";_url+="&utm_campaign=recommend";return _url}}};var wbcltApp=new Vue({el:"#optionsframework-wrap",components:{"more-wb-info":moreWbInfo,"wb-selector-bar":wbSelectorBar,"wb-tags-module":wbTagsModule},data:function(){return{new_s:"",new_r:"",cnf:cnf_cht,opt:opt_cht||{tags:{},attr:{},format:{},custom:{}},pd_code:_pd_code,opt_tags:{}}},created:function(){var vm=this;if(!vm.opt.custom)vm.opt.custom={tags:[],attr:[]};if(vm.opt.custom&&!vm.opt.custom.tags)vm.opt.custom.tags=[];if(vm.opt.custom&&!vm.opt.custom.attr)vm.opt.custom.attr=[];if(!vm.opt.attr)vm.opt.attr=[];if(!vm.opt.txt_replace)vm.opt.txt_replace=[];vm.opt_tags=vm.optTags()},computed:{allTags:function(){var vm=this;var temp=[];var obj=vm.cnf.tags;for(var row in obj){temp=temp.concat(obj[row])}return temp},allAttr:function(){var vm=this;var obj=vm.cnf.attr;return obj}},methods:{item_remove(idx){var vm=this;vm.opt.txt_replace.splice(idx,1);return false},add_item(){var vm=this;if(!vm.new_s){return false}vm.opt.txt_replace.push({s:vm.new_s,r:vm.new_r,c:0});vm.new_s="";vm.new_r=""},optTags:function(){var vm=this;var obj=vm.cnf.tags;var temp={};for(var row in obj){temp[row]=obj[row].filter(function(v){return vm.opt.tags&&vm.opt.tags.includes(v)})}return temp},updateData:function(){var vm=this;var _opt=vm.opt;var temp_tags=[];for(var row in vm.opt_tags){temp_tags=temp_tags.concat(vm.opt_tags[row])}_opt.tags=temp_tags;_opt.re_txt=JSON.stringify(_opt.txt_replace);var pam={action:"wb_cht",do:"set_setting",opt:_opt};jQuery.post(ajaxurl,pam,function(ret){vm.opt=ret.data;wbui.toast("设置保存成功")})}}});